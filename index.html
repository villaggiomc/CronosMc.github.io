<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Geometry Dash Privato - Game</title>
    <style>
        :root { --accent: #00ffcc; --bg: #0a0a1a; }
        body { margin: 0; background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; overflow: hidden; }
        .box { background: rgba(20, 20, 40, 0.9); padding: 30px; border-radius: 15px; border: 2px solid var(--accent); text-align: center; box-shadow: 0 0 20px var(--accent); }
        .grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin: 20px 0; }
        button { background: var(--accent); border: none; color: black; padding: 10px; border-radius: 5px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        button:hover { transform: scale(1.1); filter: brightness(1.2); }
        canvas { display: none; background: linear-gradient(to bottom, #0d0d1e, #1a1a2e); border-bottom: 4px solid white; cursor: crosshair; }
        .hidden { display: none; }
        #editor-ui { position: absolute; bottom: 20px; background: rgba(0,0,0,0.7); padding: 10px; border-radius: 10px; display: none; }
    </style>
</head>
<body>

    <div id="pass-screen" class="box">
        <h1>LOGIN PRIVATO</h1>
        <input type="password" id="pass-input" placeholder="Password..." style="padding:10px; border-radius:5px;">
        <button onclick="checkPass()">ENTRA</button>
    </div>

    <div id="menu-screen" class="box hidden">
        <h1>MY DASH EDITOR</h1>
        <div style="margin: 15px;">
            Colore: <input type="color" id="pColor" value="#00ffcc">
            Icona: <select id="pShape"><option value="square">Cubo</option><option value="circle">Palla</option></select>
        </div>
        <h3>LIVELLI PREDEFINITI</h3>
        <div class="grid" id="lvl-grid"></div>
        <hr>
        <button onclick="openEditor()" style="background: #ffcc00;">MODALITÃ€ EDITOR</button>
        <button id="play-custom" onclick="startLevel(-1)" style="display:none; background: #2ecc71;">GIOCA LIVELLO CREATO</button>
    </div>

    <canvas id="gameCanvas" width="900" height="400"></canvas>
    <div id="editor-ui">CLICK SUL PAVIMENTO PER SPINE | INVIO PER TESTARE | ESC PER USCIRE</div>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const passScreen = document.getElementById("pass-screen");
    const menuScreen = document.getElementById("menu-screen");
    
    let gameActive = false;
    let editorMode = false;
    let customMap = JSON.parse(localStorage.getItem('gameCustomMap')) || [];
    let obstacles = [];
    let currentSpeed = 7;

    const player = {
        x: 100, y: 340, w: 40, h: 40,
        dy: 0, gravity: 0.9, jump: -15,
        ground: 340, rot: 0, isJumping: false,
        color: "#00ffcc", shape: "square"
    };

    // Generazione 10 Livelli
    const levels = Array.from({length: 10}, (_, i) => ({
        speed: 7 + i,
        map: Array.from({length: 5 + i}, (_, j) => ({ x: 600 + (j * (450 - (i*20))), w: 30, h: 45 }))
    }));

    function checkPass() {
        if(document.getElementById("pass-input").value === "123") {
            passScreen.classList.add("hidden");
            menuScreen.classList.remove("hidden");
            initMenu();
        } else { alert("Password Errata"); }
    }

    function initMenu() {
        const grid = document.getElementById("lvl-grid");
        grid.innerHTML = "";
        levels.forEach((_, i) => {
            const btn = document.createElement("button");
            btn.innerText = i + 1;
            btn.onclick = () => startLevel(i);
            grid.appendChild(btn);
        });
        if(customMap.length > 0) document.getElementById("play-custom").style.display = "inline-block";
    }

    function openEditor() {
        editorMode = true;
        gameActive = false;
        obstacles = [...customMap];
        menuScreen.classList.add("hidden");
        canvas.style.display = "block";
        document.getElementById("editor-ui").style.display = "block";
        renderEditor();
    }

    function startLevel(idx) {
        editorMode = false;
        gameActive = true;
        player.color = document.getElementById("pColor").value;
        player.shape = document.getElementById("pShape").value;
        player.y = player.ground;
        player.dy = 0;
        player.rot = 0;

        if(idx === -1) {
            obstacles = JSON.parse(JSON.stringify(customMap));
            currentSpeed = 8;
        } else {
            obstacles = JSON.parse(JSON.stringify(levels[idx].map));
            currentSpeed = levels[idx].speed;
        }

        menuScreen.classList.add("hidden");
        canvas.style.display = "block";
        update();
    }

    canvas.addEventListener("mousedown", (e) => {
        if(!editorMode) { jump(); return; }
        const rect = canvas.getBoundingClientRect();
        const mouseX = e.clientX - rect.left;
        
        const exist = obstacles.findIndex(o => Math.abs(o.x - mouseX) < 30);
        if(exist > -1) obstacles.splice(exist, 1);
        else obstacles.push({x: mouseX, w: 30, h: 45});
        
        customMap = [...obstacles];
        localStorage.setItem('gameCustomMap', JSON.stringify(customMap));
        renderEditor();
    });

    function renderEditor() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawFloor();
        obstacles.forEach(o => drawSpike(o.x, 380, o.w, o.h));
        ctx.globalAlpha = 0.5;
        ctx.fillStyle = player.color;
        ctx.fillRect(player.x, player.ground, player.w, player.h);
        ctx.globalAlpha = 1;
    }

    function drawFloor() {
        ctx.strokeStyle = "white";
        ctx.beginPath(); ctx.moveTo(0, 380); ctx.lineTo(canvas.width, 380); ctx.stroke();
    }

    function drawSpike(x, y, w, h) {
        ctx.fillStyle = "#ff4444";
        ctx.beginPath();
        ctx.moveTo(x, y);
        ctx.lineTo(x + w/2, y - h);
        ctx.lineTo(x + w, y);
        ctx.fill();
    }

    function update() {
        if(!gameActive) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawFloor();

        player.dy += player.gravity;
        player.y += player.dy;

        if(player.y >= player.ground) {
            player.y = player.ground;
            player.dy = 0;
            player.isJumping = false;
            player.rot = Math.round(player.rot / 90) * 90;
        } else { player.rot += 7; }

        ctx.save();
        ctx.translate(player.x + player.w/2, player.y + player.h/2);
        ctx.rotate(player.rot * Math.PI / 180);
        ctx.fillStyle = player.color;
        if(player.shape === "square") {
            ctx.fillRect(-player.w/2, -player.h/2, player.w, player.h);
            ctx.strokeStyle = "white"; ctx.strokeRect(-player.w/2, -player.h/2, player.w, player.h);
        } else {
            ctx.beginPath(); ctx.arc(0, 0, player.w/2, 0, Math.PI*2); ctx.fill();
        }
        ctx.restore();

        for(let i = obstacles.length-1; i >= 0; i--) {
            obstacles[i].x -= currentSpeed;
            drawSpike(obstacles[i].x, 380, obstacles[i].w, obstacles[i].h);

            if(player.x + 30 > obstacles[i].x && player.x < obstacles[i].x + obstacles[i].w - 5 && player.y + 35 > 380 - obstacles[i].h) {
                gameActive = false;
                alert("Game Over!");
                exit();
            }
        }

        if(obstacles.length > 0 && obstacles.every(o => o.x < -100)) {
            alert("VITTORIA!");
            exit();
        }
        requestAnimationFrame(update);
    }

    function jump() {
        if(!player.isJumping && gameActive) {
            player.dy = player.jump;
            player.isJumping = true;
        }
    }

    function exit() {
        gameActive = false;
        editorMode = false;
        canvas.style.display = "none";
        menuScreen.classList.remove("hidden");
        document.getElementById("editor-ui").style.display = "none";
        initMenu();
    }

    window.addEventListener("keydown", (e) => {
        if(e.code === "Space") jump();
        if(e.code === "Enter" && editorMode) startLevel(-1);
        if(e.code === "Escape") exit();
    });
</script>
</body>
</html>
